<script>
  // var clickedBtn; var code; Gestisco il keypress sull'input
  function manageScannedKeystrokes(event) {
    // alert("Non credo vada");
    // alert("Ciao: " + DumpObject(event));
    var keycode = (event.keyCode
      ? event.keyCode
      : event.which);
    if (keycode == '13') {
      $("#send").click();
      // Seleziono tutto
      // E riporto qui il focus
    } else {
      // Scrivilo nell'input field (accumulando)
      $("input[name=barcode]").val(function (index, val) {
        // Scrivo
        return val + event.key;
      });
    }
  }
  function enableKSCapture(){
    $(document).on(kpMode, manageScannedKeystrokes);
  }
  function disableKSCapture(){
    $(document).off(kpMode, manageScannedKeystrokes);
  }

  // Init
  enableKSCapture();
  // Se $("#barcode") si becca il focus, elimino il keypress
  $("#barcode").focusin(function () {
    // Blocco il keypress del document
    disableKSCapture();
  });
  $("#barcode").focusout(function () {
    // Blocco il keypress del document
    enableKSCapture();
  });
</script>
